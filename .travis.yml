language: cpp

addons:
  apt:
    packages:
      - cmake
      - g++-5
      - gcc-5
      - icov
    sources:
      - kalakris-cmake
      - ubuntu-toolchain-r-test

before_install:
- pip install --user cpp-coveralls

install:
- if [ "$CXX" = "g++" ]; then export CXX="g++-5" CC="gcc-5"; fi

script:
- cmake ./llama_cpp/benchmark/google_benchmark
- make
- mkdir -p ../benchmark_llama_cpp
- mkdir -p ../benchmark_llama_cpp/src
- cp ./src/libbenchmark.a ../benchmark_llama_cpp/src/libbenchmark.a
- export CXX="clang++"
- ./build/build_cpp.sh all
- ./build/build_cpp.sh all coverage
- pushd ./llama_java
- ./gradlew assemble
- popd

after_success:
- coveralls --root ../build_llama_cpp/ --build-root ../build_llama_cpp/ --include *.dir --gcov-options '\-lp'

compiler: g++

sudo: false
